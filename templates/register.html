<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>西电人人书注册1.0</title>
    <!-- 引入样式 -->
	  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  </head>
  <body class='register_body' >
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <div id="app" >
        <el-button type="primary" @click="log_on()" style="background-color:#47484C">登录</el-button>
        <el-row :gutter="40">
          <!-- gutter 栅格间距 -->
          <el-col :span="10" :offset="10">
            <!-- span 栅格占的列数，offset是偏移列数 -->
            <div class="grid-content"></div>
          </el-col>
        </el-row>

        <el-row :gutter="100">
          <!-- gutter 栅格间距 -->

          <el-col :span="8" :offset="8">
            <!-- span 栅格占的列数，offset是偏移列数 -->
            <el-card shadow="always" class="card_register">
              <h1>欢迎注册  XD人人书</h1>
              <!--<el-button type="primary" icon="el-icon-right"
                >切换至商家版</el-button
              >-->
              <el-switch
                v-model="value1"
                active-text="个人版"
                inactive-text="商家版"

              >
              </el-switch>

              <el-divider></el-divider>

              <el-form
                :model="nameValidateForm"
                ref="nameValidateForm"
                label-width="130px"
                class="demo-ruleForm"
              >
                <!-- 用户名 -->
                <el-form-item
                  label="用户名(学号)"
                  prop="name"
                  :rules="[{ required: true, message: '用户名不能为空' }]"
                >
                  <el-input
                    placeholder="请输入用户名"
                    type="text"
                    v-model="nameValidateForm.name"
                    autocomplete="off"
                  ></el-input>
                </el-form-item>

                <!-- 手机号 -->
                <el-form-item
                  label="手机号or激活码"
                  prop="phonenumber"
                  :rules="[{ required: true, message: '手机号（激活码）不能为空！' }]"
                >

                  <el-input
                    placeholder="请输入手机号"
                    type="text"
                    v-model="nameValidateForm.phonenumber"
                    autocomplete="off"
                  ></el-input>
                </el-form-item>

                <!-- 密码 -->
                <el-form-item
                  label="密 码"
                  prop="password"
                  :rules="[{ required: true, message: '密码不能为空' }]"
                >
                  <el-input
                    type="text"
                    placeholder="请输入密码"
                    v-model="nameValidateForm.password"
                    show-password
                  ></el-input>
                </el-form-item>
                  <el-form-item
                  label="确认密码"
                  prop="password"
                  :rules="[{ required: true, message: '密码不能为空' }]"
                >
                  <el-input
                    type="text"
                    placeholder="请输入密码"
                    v-model="nameValidateForm.repassword"
                    show-password
                  ></el-input>
                </el-form-item>
                <el-form-item>
                    {% csrf_token %}
                  <el-button type="primary" @click="submitForm('nameValidateForm')" style="background-color:#47484C"
                    >提交</el-button>
                  <el-button @click="resetForm('nameValidateForm')">重置</el-button>
                </el-form-item>
              </el-form>
            </el-card>
          </el-col>
        </el-row>
      </div>
  </body>
  <script>

    new Vue({
    el: '#app',
    //router,
    //components: { App },
    //template: '<App/>',
    //render: h => h(App),
    data() {
        return {
            value1: true,
            nameValidateForm: {
              name: "",
              password: "",
              phonenumber:"",
              repassword:"",
            }
        };
      },
      methods: {
        submitForm(formName)
        {

            this.$refs[formName].validate(valid => {
                if (valid)
                {
                    if(this.nameValidateForm.password!=this.nameValidateForm.repassword)
                    {
                        alert("两次密码要相同！！")
                    }
                    else
                    {
                                //跨域解决代码
                        axios.defaults.withCredentials = true;
                        axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
                        if(this.value1==true)//个人用户注册
                        {
                            axios.post("register_handle",[{
                                'user_id':this.nameValidateForm.name,
                                'user_phone':this.nameValidateForm.phonenumber,
                                'user_password':this.nameValidateForm.password,
                            }]).then(re=>
                            {
                                if(re.data.flag==0)//在json文件中定义一个flag，注册成功即返回一；否则返回零
                                {
                                    alert("注册成功！")
                                    axios.post('jumpurl',[{
                                        'jurl':'http://127.0.0.1:8000/miaIndex'
                                    }])
                                    window.location.href="http://127.0.0.1:8000/miaIndex"
                                }
                                else{
                                    alert("注册失败！学号已被注册")
                                }
                            })
                        }
                        else
                        {//商家用户注册

                            axios.post("ad_register_handle",[{
                                'ad_id':this.nameValidateForm.name,
                                'ad_active':this.nameValidateForm.phonenumber,
                                'ad_password':this.nameValidateForm.password,
                            }]).then(re=>{
                                if(re.data.flag==1)//在json文件中定义一个flag，注册成功即返回一；否则返回零
                                {
                                    if(re.data.flag1==0)
                                    {
                                        alert("注册成功")
                                        window.location.href="http://127.0.0.1:8000/miaIndex"
                                    }
                                    else{
                                        alert("该账号已被注册！")
                                    }

                                }
                                else
                                {
                                    alert("激活码错误！")
                                }
                            })
                        }
                    }
                }
                else
                {
                  console.log("error submit!!");
                  return false;
                }
            });
        },
          log_on()
          {
              window.location.href="http://127.0.0.1:8000/log_on"
          },

        resetForm(formName)
        {
          this.$refs[formName].resetFields();
        },
        change()
        {
            this.value1=!(this.value1)
            console.log(this.value1);
        }
      }
    });
    Vue.use(ElementUI);
    Vue.config.productionTip = false
    </script>

    <style>
    .content {
      margin: 0 auto;
    }
    .el-card {
      border-radius: 35px;
      /* box-shadow: 0 2px 12px 0 rgb(243, 102, 102); */
      /* box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04); */
    }
    .grid-content {
      /* background: rgb(14, 214, 131); */
      border-radius: 4px;
      min-height: 80px;
    }
    .el-row {
      margin-bottom: 20px;
    }
    .register_body{
        background:url('../static/image/card.jpg');
        background-size: cover;
    }
    .card_register{
        background-color:rgba(255,255,255,0.3);
    }
    </style>
</html>
